<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="adminOrderlist">




	<!-- 전체주문 리스트 보기 -->
	<select id="allOrderList" resultType="hashmap">
		<![CDATA[ 
			SELECT A.ORDER_NUM, D.GOODS_IMG1,	B.GOODS_NAME, C.MEMBER_ID, F.ORDER_AMOUNT_SUM, 
        			E.ORDER_PAY_SUM, A.ORDER_PAYMENT, A.ORDER_DATE
			FROM ORDERS A, GOODS B, MEMBER C, GOODS_IMG D, 
        		(SELECT ORDER_NUM, SUM(ORDER_PRICE) AS ORDER_PAY_SUM FROM ORDERS GROUP BY ORDER_NUM) E,
        		(SELECT ORDER_NUM,SUM(ORDER_AMOUNT) AS ORDER_AMOUNT_SUM FROM ORDERS GROUP BY ORDER_NUM) F
			WHERE 
			A.MEMBER_NUM = C.MEMBER_NUM
			AND A.ORDER_NUM = E.ORDER_NUM
      		AND A.ORDER_NUM = F.ORDER_NUM
			AND A.GOODS_NUM = B.GOODS_NUM 
			AND B.GOODS_NUM = D.GOODS_NUM
			ORDER BY A.ORDER_DATE DESC, A.ORDER_NUM DESC
		]]>
	</select>
	
	
	
	<!--  전체주문 수 보기  -->
	<select id="allOrderNumList" resultType="integer">
	<![CDATA[
		SELECT COUNT(ORDER_NUM) FROM ORDERS ORDER BY ORDER_NUM DESC
	]]>
	</select>
	
	
	
	<!-- 주문삭제 -->
	<delete id="orderDelete" parameterType="hashmap">
		<![CDATA[
	DELETE ORDERS WHERE ORDER_NUM = #{ORDER_NUM}
		]]>
	</delete>
	
	<!-- 관리자가 사용자 ID로 주문 검색하기 -->
<select id="adminOrderSearchID" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
	SELECT
	O.ORDER_NUM,
	O.ORDER_AMOUNT,
	O.MEMBER_NUM,
	O.GOODS_NUM,
	O.ORDER_DATE,
	O.ORDER_PRICE,
	O.ORDER_PAYMENT
	FROM
	ORDERS O, MEMBER M
	WHERE
	M.MEMBER_NUM=O.MEMBER_NUM and M.member_id LIKE '%'|| #{searchkeyword} || '%'
		]]>
	</select>
	
	<!-- 결제상태에 따른 검색 -->
<select id="adminOrderSearchPay" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
	SELECT
	ORDER_NUM,
	ORDER_AMOUNT,
	MEMBER_NUM,
	GOODS_NUM,
	ORDER_DATE,
	ORDER_PRICE,
	ORDER_PAYMENT,
	ORDER_ECHECK
	FROM
	ORDERS WHERE ORDER_PAYMENT=#{ORDER_PAYMENT};
		]]>
	</select>

	<!-- 결제상태 변경 -->
	<update id="updateOrderPayment" parameterType="hashmap">
	
	<![CDATA[
		UPDATE 	ORDERS SET
	ORDER_PAYMENT=#{ORDER_PAYMENT}
	WHERE ORDER_NUM=#{ORDER_NUM};
	]]>
	
	</update>
	<!-- 회원 주문상세보기 -->
	<select id="orderDetail" resultType="hashmap">
		<![CDATA[
		SELECT
			M.MEMBER_NAME,
			M.MEMBER_ID,
			M.MEMBER_EMAIL,
			M.MEMBER_PHONE,
			G.GOODS_NAME,
			G.GOODS_PRICE,
			G.GOODS_DCPRICE,
			O.ORDER_AMOUNT
			FROM
			GOODS G,
			MEMBER M,
			ORDERS O
				WHERE
			O.GOODS_NUM = G.GOODS_NUM
					AND
			O.MEMBER_NUM = M.MEMBER_NUM
					AND
			O.MEMBER_NUM=#{MEMBER_NUM} AND O.GOODS_NUM=#{GOODS_NUM};
		]]>
	</select>
	
</mapper>